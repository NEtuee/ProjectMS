<AIGraph Name="SisterKnifeAI" DefaultState="Release">

    <Include Path="Assets/Data/AILibrary/Package/CommonDeadPackage.xml"/>
    <Include Path="Assets/Data/AILibrary/Package/CommonIdlePackage.xml"/>
    <Include Path="Assets/Data/AILibrary/Package/CommonChasePackage.xml"/>

<CustomValue Name="AttackCount" Value="0.0"/>
<CustomValue Name="IsRelease" Value="-1.0"/>

<CustomEvent_AttackCount>
    <AIEvent Type="AddCustomValue" Name="AttackCount" Value="1.0"/>
</CustomEvent_AttackCount>
<CustomEvent_KnifeRelease>
    <AIEvent Type="SetCustomValue" Name="IsRelease" Value="1.0"/>
</CustomEvent_KnifeRelease>

    <AIPackage Name="KnifeChasePackage" DefaultState="AI_Idle">
        <AIState>
            <AI_Idle UpdateTime="0.0" TargetSearchType="Near" TargetSearchRange="999.9" AllyTarget="Enemy">
                <Event_OnExecute>
                    <AIEvent Type="SetAction" Action="AC_Idle"/>
                </Event_OnExecute>
                
                <Branch Condition="End" Execute="AI_Idle"/>
            </AI_Idle>
            <AI_Release UpdateTime="0.0" TargetSearchType="Near" TargetSearchRange="999.9" AllyTarget="Enemy">
                <Event_OnExecute>
                    <AIEvent Type="SetDirectionToTarget" Speed="120"/>
                    <AIEvent Type="SetAction" Action="AC_Release"/>
                </Event_OnExecute>
                <Event_OnFrame>
                    <AIEvent Type="SetDirectionToTarget" Speed="120"/>
                </Event_OnFrame>
                
                <Branch Condition="PackageExecutedTime >= 2.0" Execute="AI_Chase"/>
            </AI_Release>
            <AI_Chase UpdateTime="0" TargetSearchType="Near" TargetSearchRange="999.9" AllyTarget="Enemy">
                <Event_OnExecute>
                    <AIEvent Type="SetDirectionToTarget" Speed="180"/>
                    <AIEvent Type="SetAction" Action="AC_Move"/>
                </Event_OnExecute>

                <Event_OnUpdate>
                    <AIEvent Type="SetDirectionToTarget" Speed="180"/>
                </Event_OnUpdate>
                
                <Branch Condition="((AngleDirectionToTarget < 1.0) && (AngleDirectionToTarget > -1.0)) && (TargetDistance < 2.0)" Execute="AI_Attack"/>
            </AI_Chase>
            <AI_Attack UpdateTime="0" TargetSearchType="Near" TargetSearchRange="999.9" AllyTarget="Enemy">
                <Event_OnExecute>
                    <AIEvent Type="SetAction" Action="AC_Accel"/>
                </Event_OnExecute>

                <Event_OnUpdate>
                    <AIEvent Type="SetDirectionToTarget" Speed="60"/>
                </Event_OnUpdate>
                
                <Branch Condition="End" Execute="AI_Chase"/>
            </AI_Attack>

            <AI_Reverse UpdateTime="0" TargetSearchType="Near" TargetSearchRange="999.9" AllyTarget="Enemy">
                <Event_OnExecute>
                    <AIEvent Type="SetAction" Action="AC_Reverse"/>
                </Event_OnExecute>

                <Event_OnFrame>
                    <AIEvent Type="SetDirectionToTarget" Speed="360"/>
                </Event_OnFrame>

                <Branch Condition="End" Execute="AI_Chase"/>
            </AI_Reverse>
            <TerminatePackage>
                <Event_OnExecute>
                    <AIEvent Type="TerminatePackage"/>
                </Event_OnExecute>
            </TerminatePackage>
        </AIState>
    </AIPackage>

    <Spawn Package="KnifeChasePackage">
        <Branch Condition="Dead" Execute="Dead"/>
        <Branch Condition="customValue_IsRelease == 1.0" Execute="Release"/>
    </Spawn>
    <Release Package="KnifeChasePackage" EntryNode="AI_Release">
        <Branch Condition="Dead" Execute="Dead"/>
        <Branch Condition="GuardBroken || GuardBreakFail" Execute="Reverse"/>
        <Branch Condition="customValue_AttackCount >= 3.0" Execute="Dead"/>
    </Release>
    <Reverse Package="KnifeChasePackage" EntryNode="AI_Reverse">
        <Branch Condition="Dead" Execute="Dead"/>
        <Branch Condition="customValue_AttackCount >= 3.0" Execute="Dead"/>
    </Reverse>

    <Dead Package="CommonDeadPackage">
    </Dead>


</AIGraph>