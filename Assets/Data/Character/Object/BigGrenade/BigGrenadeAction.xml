<ActionGraph Name="BigGrenadeAction" DefaultAction="Move" DefaultFramePerSecond="12">

    <Move MovementType="GraphPreset" MovementGraphPreset="Sukeban_BigGrnade" DirectionType="AI" FlipType="Direction" RotationType="Direction">
        <!-- TODO: 폭발 도달 속도 플레이 해보고 조절할 것 -->
        <Animation Preset="Sprites/Object/BigGrenade/1_move" XFlip="true" Duration="1.0">
        </Animation>

        <Branch Condition="Hit" Execute="Destroy"/>
        <Branch Condition="GuardBroken || GuardBreakFail" Execute="AC_Reverse"/>
        <Branch Condition="End" Execute="ExplosionAtmosphere"/>
    </Move>

    <ExplosionAtmosphere MovementType="Empty" DirectionType="Keep">
        <Animation Preset="Sprites/Object/BigGrenade/2_explosionatmosphere" Duration="1.5">
        </Animation>
        
        <Branch Condition="Hit" Execute="Destroy"/>
        <Branch Condition="GuardBroken || GuardBreakFail" Execute="AC_Reverse"/>
        <Branch Condition="End" Execute="Explosion"/>
    </ExplosionAtmosphere>

    <Explosion MovementType="Empty" DirectionType="Keep" DefenceType="Evade" DefenceAngle="360">
        <Animation Preset="Sprites/Object/BigGrenade/3_explosion" Duration="0.2">
            <FrameEvent Type="AudioPlay" StartTime="0.1" ID="6002" Attach="true"/>
            <!-- TODO: 폭발 이펙트  -->
            <FrameEvent Type="EffectPreset"  EndTime="0.2" Key="Helena_Explode"/>
            <FrameEvent Type="Attack" StartTime="0.1" EndTime="0.2" AttackPreset="Common_Radius05">
                <OnHit>
                    <FrameEvent Type="ApplyBuffTarget" ApplyBuff="CommonAttack"/>
                </OnHit>
            </FrameEvent>
        </Animation>
        <Branch Condition="End" Execute="Exit"/>
    </Explosion>

    <AC_Reverse MovementType="FrameEvent" DirectionType="AttackedPoint" FlipType="Direction" RotationType="Keep" DirectionAngle="180">
        <Animation Preset="Sprites/Object/BigGrenade/4_reverse" Duration="0.27">
            <FrameEvent Type="ChangeAlly" StartTime="0" Key="PlayerBattleObject" ResetTarget="True"/>
            <FrameEvent Type="Movement" StartTime="0" Friction="3" Velocity="7" MaxVelocity="7" Speed="0"/>
        </Animation>

        <Branch Condition="End" Execute="Explosion"/>
    </AC_Reverse>

    <Exit MovementType="Empty" DirectionType="Keep">
        <Animation Preset="Sprites/Object/BigGrenade/5_exit" Duration="0.016">
            <FrameEvent Type="KillEntity" StartTime="0"/>
        </Animation>

        <Branch Condition="End" Execute="Exit"/>
    </Exit>

    <Destroy MovementType="Empty" DirectionType="Keep">
        <Animation Preset="Sprites/Object/BigGrenade/6_destory" Duration="0.016">
            <FrameEvent Type="AudioPlay" StartTime="0" ID="2416" Attach="true"/>
            <FrameEvent Type="KillEntity" StartFrame="0"/>
        </Animation>

        <Branch Condition="End" Execute="Destroy"/>
    </Destroy>

</ActionGraph>