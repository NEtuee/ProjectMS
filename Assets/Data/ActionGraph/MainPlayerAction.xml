

<ActionGraph Name="Test" DefaultAction="Idle" DefaultFramePerSecond="4" DefaultBuff="4 5 8">

    <GlobalVariable Name="gv_DashVelocity" Value="10"/>
    <GlobalVariable Name="gv_DashFriction" Value="24"/>

    <GlobalVariable Name="gv_MoveSpeed" Value="45"/>
    <GlobalVariable Name="gv_MoveVelocityMax" Value="3"/>

    <GlobalVariable Name="gv_AttackVelocity" Value="3"/>
    <GlobalVariable Name="gv_AttackFriction" Value="12"/>

    <GlobalVariable Name="gv_IdleFriction" Value="10"/>

    <GlobalVariable Name="gv_rotateSpeed" Value="840"/>

    <BranchSet Name="CommonBattleBranchSet">
        <Branch Key="getKey_Guard" Condition="true" Execute="Guard"/>
    </BranchSet>

    <Idle MovementType="FrameEvent" DirectionType="Keep" FlipType="MousePoint">
        <Animation Path="Resources/Sprites/NewPlayer/idle/" FramePerSecond="12" XFlip="true" Loop="false">
            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_IdleFriction" Speed="0"/>
        </Animation>

        <UseBranchSet Name="CommonBattleBranchSet"/>

        <Branch Key="getKey_AttackCharge == true" Execute="DashRoll"/>
        <Branch Condition="End == true" Execute="Idle"/>
    </Idle>

    <MoveStop MovementType="FrameEvent" DirectionType="Keep" FlipType="MoveDirection">
        <Animation Path="Resources/Sprites/NewPlayer/MoveStop/" FramePerSecond="16" XFlip="true" Loop="false">
            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_IdleFriction" Speed="0" Velocity="gv_MoveVelocityMax"/>
        </Animation>

        <UseBranchSet Name="CommonBattleBranchSet"/>

        <Branch Key="getKey_AttackCharge == true" Execute="DashRoll"/>
        <Branch Condition="End == true" Execute="Idle"/>
    </MoveStop>

    <MoveAll MovementType="FrameEvent" DirectionType="MousePoint" RotationType="MoveDirection" FlipType="MousePoint" FlipTypeUpdateOnce="True" RotateBySpeed="True" RotateSpeed="gv_rotateSpeed">
        <Animation Path="Resources/Sprites/NewPlayer/MoveRotate/" FramePerSecond="1" AngleBaseAnimation="True" XFlip="true">
            <FrameEvent Type="Movement" StartFrame="0" Friction="0" MaxVelocity="gv_MoveVelocityMax" Speed="gv_MoveSpeed"/>
        </Animation>

        <UseBranchSet Name="CommonBattleBranchSet"/>

        <Branch Condition="End == true" Execute="MoveAll"/>
        <Branch Key="getKey_AttackCharge == false" Execute="MoveStop"/>
    </MoveAll>

    <DashRoll MovementType="FrameEvent" DirectionType="MousePoint" RotationType="MoveDirection" FlipType="MousePoint" DirectionUpdateOnce="true">
        <Animation Path="Resources/Sprites/NewPlayer/DashRoll/" FramePerSecond="32" XFlip="true">
            <FrameEvent Type="Attack" StartFrame="0" AttackPreset="PlayerAttackTest">
                <OnHit>
                    <FrameEvent Type="ApplyBuffTarget" ApplyBuff="1"/>
                    <FrameEvent Type="ApplyBuff" ApplyBuff="6 7"/>

                    <FrameEvent Type="TeleportToTargetBack"/>
                    <FrameEvent Type="Effect" Path="Resources/Sprites/Effect/AttackHit" FramePerSecond="18.0" Offset="0.0 0.0 0.0" Angle="Random_0^360" ToTarget="true"/>
                </OnHit>

                <OnGuard>
                    <FrameEvent Type="TeleportToTarget"/>
                </OnGuard>

                <OnParry>
                    <FrameEvent Type="TeleportToTarget"/>
                </OnParry>

            </FrameEvent>
            <FrameEvent Type="FrameTag" StartFrame="4" EndFrame="999" Tag="MoveCancel"/>

            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_DashFriction" MaxVelocity="gv_DashVelocity" Speed="0" Velocity="gv_DashVelocity"/>
        </Animation>

        <Branch Condition="AttackSuccess" Execute="AttackSuccess"/>
        <Branch Key="getKey_AttackCharge == true" Condition="End" Execute="MoveAll"/>
        <Branch Key="getKey_AttackCharge == false" Condition="End" Execute="MoveStop"/>
        <Branch Key="getKey_AttackCharge == false" Condition="getFrameTag_MoveCancel" Execute="MoveStop"/>
    </DashRoll>

    <AttackSuccess MovementType="FrameEvent" DirectionType="MousePoint" RotationType="Direction" FlipType="Direction" DirectionUpdateOnce="true">
        <Animation Path="Resources/Sprites/NewPlayer/attack/" FramePerSecond="12" XFlip="true">
            <FrameEvent Type="Effect" StartFrame="0" Path="Resources/Sprites/Effect/Sheath" FramePerSecond="0.5" Offset="0.0 0.0 0.0" Angle="Random_0^360" UseFlip="True">
                <Physics UseGravity="True" Velocity="-1.5^3.5" Friction="1.0" Torque="Random_25^30" AngularFriction="10.0"/>
            </FrameEvent>

            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_AttackFriction" MaxVelocity="gv_AttackVelocity" Speed="0" Velocity="gv_AttackVelocity"/>
        </Animation>

        <Branch Key="getKey_AttackCharge == true" Condition="End" Execute="MoveAll"/>
        <Branch Key="getKey_AttackCharge == false" Condition="End" Execute="Idle"/>
    </AttackSuccess>

    <Guard MovementType="GraphPreset" MovementGraphPreset="Guard" DirectionType="MousePoint" DefenceDirectionType="MousePoint" FlipType="Keep" DefenceType="Guard" DefenceAngle="180.0">
        <Animation Path="Resources/Sprites/DummyPlayer/Guard/" StartFrame="0" EndFrame="1" FramePerSecond="1" XFlip="true">
        </Animation>

        <Branch Condition="End" Execute="Guard"/>
        <Branch Key="(getKey_Guard == false) && (getKey_AttackCharge == true)" Execute="MoveAll"/>
        <Branch Key="(getKey_Guard == false) && (getKey_AttackCharge == false)" Execute="Idle"/>
    </Guard>

    <Kiiled DirectionType="Keep" FlipType="Direction">
        <Animation Path="Resources/Sprites/DummyPlayer/Hit/" StartFrame="0" EndFrame="1" FramePerSecond="99" XFlip="true">
            <FrameEvent Type="KillEntity" StartFrame="0"/>
        </Animation>

        <Branch Condition="End == true" Execute="Kiiled"/>
    </Kiiled>

</ActionGraph>