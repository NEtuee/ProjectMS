

<ActionGraph Name="Test" DefaultAction="Idle" DefaultFramePerSecond="4" DefaultBuff="4 5 8">

    <GlobalVariable Name="gv_DashVelocity" Value="10"/>
    <GlobalVariable Name="gv_DashFriction" Value="24"/>

    <GlobalVariable Name="gv_MoveSpeed" Value="45"/>
    <GlobalVariable Name="gv_MoveVelocityMax" Value="3"/>

    <GlobalVariable Name="gv_AttackVelocity" Value="6.5"/>
    <GlobalVariable Name="gv_AttackFriction" Value="15"/>

    <GlobalVariable Name="gv_IdleFriction" Value="8"/>

    <GlobalVariable Name="gv_rotateSpeed" Value="840"/>


    <Idle MovementType="FrameEvent" DirectionType="Keep" FlipType="MousePoint">
        <Animation Path="Resources/Sprites/NewPlayer/idle/" FramePerSecond="12" XFlip="true" Loop="false">
            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_IdleFriction" Speed="0"/>
        </Animation>

        <!-- <Branch Key="getKey_Guard && getKey_AttackCharge" Condition="true" Execute="Guard"/> -->
        <Branch Key="getKey_GuardBreak2 && getKey_AttackCharge" Execute="DashRoll_Kick"/>
        <Branch Key="getKey_StunShot && getKey_AttackCharge" Execute="StunShot"/>
        <Branch Key="getKey_AttackCharge == true" Execute="DashRoll"/>
        <Branch Key="getKey_NormalMove == true" Execute="MoveAll"/>

        <Branch Condition="End == true" Execute="Idle"/>
    </Idle>
    
    <MoveStop MovementType="FrameEvent" DirectionType="Keep" FlipType="Direction">
        <Animation Path="Resources/Sprites/NewPlayer/MoveStop/" FramePerSecond="16" XFlip="true" Loop="false" >
            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_IdleFriction" Speed="0" Velocity="gv_MoveVelocityMax"/>
        </Animation>
        
        <!-- <Branch Key="getKey_Guard && getKey_AttackCharge" Condition="true" Execute="Guard"/> -->
        <Branch Key="getKey_GuardBreak2 && getKey_AttackCharge" Execute="DashRoll_Kick"/>
        <Branch Key="getKey_StunShot && getKey_AttackCharge" Execute="StunShot"/>
        <Branch Key="getKey_AttackCharge == true" Execute="DashRoll"/>
        <Branch Key="getKey_NormalMove == true" Execute="MoveAll"/>

        <Branch Condition="End == true" Execute="Idle"/>
    </MoveStop>

    <AttackStop MovementType="FrameEvent" DirectionType="Keep" FlipType="Direction">
        <Animation Path="Resources/Sprites/NewPlayer/attackStop/" FramePerSecond="10" XFlip="true" Loop="false" >
            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_IdleFriction" Speed="0" Velocity="0"/>
        </Animation>

        <!-- <Branch Key="getKey_Guard && getKey_AttackCharge" Condition="true" Execute="Guard"/> -->
        <Branch Key="getKey_GuardBreak2 && getKey_AttackCharge" Execute="DashRoll_Kick"/>
        <Branch Key="getKey_StunShot && getKey_AttackCharge" Execute="StunShot"/>
        <Branch Key="getKey_AttackCharge == true" Execute="DashRoll"/>
        <Branch Key="getKey_NormalMove == true" Execute="MoveAll"/>

        <Branch Condition="End == true" Execute="Idle"/>
    </AttackStop>

    <MoveAll MovementType="FrameEvent" DirectionType="MousePoint" RotationType="MoveDirection" FlipType="MousePoint" FlipTypeUpdateOnce="True" RotateBySpeed="True" RotateSpeed="gv_rotateSpeed">
        <Animation Path="Resources/Sprites/NewPlayer/MoveRotate/" FramePerSecond="1" AngleBaseAnimation="True" XFlip="true">
            <FrameEvent Type="Movement" StartFrame="0" Friction="0" MaxVelocity="gv_MoveVelocityMax" Speed="gv_MoveSpeed"/>
        </Animation>

        <Branch Key="getKey_Guard && getKey_AttackCharge" Condition="true" Execute="Guard"/>

        <Branch Condition="End == true" Execute="MoveAll"/>
        <Branch Key="(getKey_AttackCharge == false) && (getKey_NormalMove == false)" Execute="MoveStop"/>
    </MoveAll>

    <DashRoll MovementType="FrameEvent" DirectionType="MousePoint" RotationType="MoveDirection" FlipType="MousePoint" DirectionUpdateOnce="true">
        <Animation Path="Resources/Sprites/NewPlayer/DashRoll/" FramePerSecond="32" XFlip="true" ScalePreset="YSpring">
            <FrameEvent Type="Attack" StartFrame="0" AttackPreset="PlayerAttackTest">
                <OnHit>
                    <FrameEvent Type="ApplyBuffTarget" ApplyBuff="1"/>
                    <FrameEvent Type="ApplyBuff" ApplyBuff="6 7"/>

                    <FrameEvent Type="TeleportToTargetBack" DistanceOffset="-0.3"/>
                    <FrameEvent Type="Effect" Path="Resources/Sprites/Effect/AttackHit" FramePerSecond="18.0" Offset="0.0 0.0 0.0" Angle="Random_0^360" ToTarget="true"/>

                    <FrameEvent Type="ZoomEffect" StartFrame="0" Scale="2.9"/>
                    <FrameEvent Type="StopUpdate" StartFrame="0" Time="0.07"/>
                </OnHit>
                <OnGuard>
                    <FrameEvent Type="Effect" Path="Resources/Sprites/Effect/ProjectileHit" FramePerSecond="18.0" Offset="0.0 0.0 0.0" ToTarget="True"/>

                    <FrameEvent Type="TeleportToTarget"/>
                    <FrameEvent Type="ZoomEffect" StartFrame="0" Scale="3.1"/>
                    <FrameEvent Type="StopUpdate" StartFrame="0" Time="0.01"/>
                </OnGuard>
                <OnParry>
                    <FrameEvent Type="TeleportToTarget"/>
                </OnParry>

            </FrameEvent>
            <FrameEvent Type="FrameTag" StartFrame="5" EndFrame="999" Tag="MoveCancel"/>

            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_DashFriction" MaxVelocity="gv_DashVelocity" Speed="0" Velocity="gv_DashVelocity"/>
        </Animation>

        <Branch Condition="AttackSuccess" Execute="AttackSuccess"/>
        <Branch Condition="AttackGuarded" Execute="AttackGuarded"/>
        <Branch Key="getKey_AttackCharge == true" Condition="End" Execute="MoveAll"/>
        <Branch Key="getKey_AttackCharge == false" Condition="End" Execute="MoveStop"/>
        <Branch Key="getKey_AttackCharge == false" Condition="getFrameTag_MoveCancel" Execute="MoveStop"/>
    </DashRoll>

    <DashRoll_Kick MovementType="FrameEvent" DirectionType="MousePoint" RotationType="MoveDirection" FlipType="MousePoint" DirectionUpdateOnce="true">
        <Animation Path="Resources/Sprites/NewPlayer/DashRoll/" FramePerSecond="32" XFlip="true" ScalePreset="YSpring">
            <FrameEvent Type="Attack" StartFrame="0" AttackType="GuardBreak" AttackPreset="Akane_Kick" IgnoreDefenceType="Guard">
                <OnHit>
                    <FrameEvent Type="Effect" Path="Resources/Sprites/Effect/AttackHit" FramePerSecond="18.0" Offset="0.0 0.0 0.0" Angle="Random_0^360" ToTarget="true"/>
                    <FrameEvent Type="Effect" Path="Resources/Sprites/Effect/ParrySucc" FramePerSecond="18.0" Offset="0.0 0.0 0.0" ToTarget="true"/>
                    
                    <FrameEvent Type="TeleportToTarget" DistanceOffset="-0.3"/>
                    
                    <FrameEvent Type="ZoomEffect" StartFrame="0" Scale="2.8"/>
                    <FrameEvent Type="StopUpdate" StartFrame="0" Time="0.15"/>
                </OnHit>
                <OnGuardBreak>
                    <FrameEvent Type="ApplyBuffTarget" StartFrame="0" ApplyBuff="21"/>
                    <FrameEvent Type="Effect" Path="Resources/Sprites/Effect/AttackHit" FramePerSecond="18.0" Offset="0.0 0.0 0.0" Angle="Random_0^360" ToTarget="true"/>
                    <FrameEvent Type="Effect" Path="Resources/Sprites/Effect/ParrySucc" FramePerSecond="18.0" Offset="0.0 0.0 0.0" ToTarget="true"/>
                    
                    <FrameEvent Type="TeleportToTarget" DistanceOffset="-0.3"/>
                    <FrameEvent Type="ZoomEffect" StartFrame="0" Scale="2.8"/>
                    <FrameEvent Type="StopUpdate" StartFrame="0" Time="0.15"/>
                </OnGuardBreak>

                <OnGuardBreakFail>
                    <FrameEvent Type="ApplyBuffTarget" StartFrame="0" ApplyBuff="21"/>
                    <FrameEvent Type="Effect" Path="Resources/Sprites/Effect/AttackHit" FramePerSecond="18.0" Offset="0.0 0.0 0.0" Angle="Random_0^360" ToTarget="true"/>
                    <FrameEvent Type="Effect" Path="Resources/Sprites/Effect/ParrySucc" FramePerSecond="18.0" Offset="0.0 0.0 0.0" ToTarget="true"/>
                    
                    <FrameEvent Type="TeleportToTarget" DistanceOffset="-0.3"/>
                    <FrameEvent Type="ZoomEffect" StartFrame="0" Scale="2.8"/>
                    <FrameEvent Type="StopUpdate" StartFrame="0" Time="0.15"/>
                </OnGuardBreakFail>
            </FrameEvent>

            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_DashFriction" MaxVelocity="gv_DashVelocity" Speed="0" Velocity="gv_DashVelocity"/>
            <FrameEvent Type="FrameTag" StartFrame="5" EndFrame="999" Tag="MoveCancel"/>
        </Animation>
        
        <Branch Condition="AttackSuccess || AttackGuarded || AttackGuardBreak || AttackGuardBreakFail" Execute="Kicked"/>
        <Branch Key="getKey_AttackCharge == true" Condition="End" Execute="MoveAll"/>
        <Branch Key="getKey_AttackCharge == false" Condition="End" Execute="MoveStop"/>
        <Branch Key="getKey_AttackCharge == false" Condition="getFrameTag_MoveCancel" Execute="MoveStop"/>
    </DashRoll_Kick>

    <StunShot MovementType="FrameEvent" DirectionType="MousePoint" FlipType="Direction" DirectionUpdateOnce="true">
        <Animation Path="Resources/Sprites/DummyPlayer/Guard/" FramePerSecond="3" AngleBaseAnimation="True" XFlip="true" ScalePreset="XSpring">
            <FrameEvent Type="Movement" StartFrame="0" Friction="22" MaxVelocity="18" Speed="0" Velocity="-6"/>

            <FrameEvent Type="Projectile" StartFrame="0" GraphName="StunShot" DirectionType="MousePoint"/>

            <FrameEvent Type="ZoomEffect" StartFrame="0" Scale="3.1"/>
        </Animation>

        <Branch Condition="AttackSuccess" Execute="AttackSuccess"/>
        <Branch Key="getKey_AttackCharge == true" Condition="End" Execute="DashRoll"/>
        <Branch Key="getKey_NormalMove == true" Condition="End" Execute="MoveAll"/>
        <Branch Key="getKey_AttackCharge == false" Condition="End" Execute="Idle"/>
    </StunShot>

    <Kicked MovementType="FrameEvent" DirectionType="Keep" RotationType="Direction" FlipType="Direction" DirectionUpdateOnce="true">
        <Animation Path="Resources/Sprites/NewPlayer/attack/" FramePerSecond="18" XFlip="true" ScalePreset="YSpring">
            <FrameEvent Type="Movement" StartFrame="0" Friction="3" Speed="0" Velocity="-2 "/>
            <FrameEvent Type="Test" StartFrame="0" Log="Kicked Executed"/>
        </Animation>

        <!-- <Branch Condition="AttackSuccess" Execute="AttackSuccess"/> -->
        <Branch Key="(getKey_AttackCharge == true) || (getKey_NormalMove == true)" Condition="End" Execute="MoveAll"/>
        <Branch Key="getKey_AttackCharge == false" Condition="End" Execute="Idle"/>
    </Kicked>

    <AttackSuccess MovementType="FrameEvent" DirectionType="Keep" RotationType="Direction" FlipType="Direction" DirectionUpdateOnce="true">
        <Animation Path="Resources/Sprites/NewPlayer/attack/" FramePerSecond="24" XFlip="true" ScalePreset="YSpring">
            <FrameEvent Type="Effect" StartFrame="0" Path="Resources/Sprites/Effect/Sheath" FramePerSecond="0.5" Offset="0.0 0.0 0.0" Angle="Random_0^360" UseFlip="True">
                <Physics UseGravity="True" Velocity="-1.5 3.5" Friction="1.0" Torque="Random_25^30" AngularFriction="10.0"/>
            </FrameEvent>

            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_AttackFriction" MaxVelocity="gv_AttackVelocity" Speed="0" Velocity="gv_AttackVelocity"/>
        </Animation>

        <Branch Key="(getKey_AttackCharge == true) || (getKey_NormalMove == true)" Condition="End" Execute="MoveAll"/>
        <Branch Key="getKey_AttackCharge == false" Condition="End" Execute="AttackStop"/>
    </AttackSuccess>

    <AttackGuarded MovementType="FrameEvent" DirectionType="Keep" RotationType="Direction" FlipType="Keep">
        <Animation Path="Resources/Sprites/NewPlayer/Attack/" FramePerSecond="16">
            <FrameEvent Type="Movement" StartFrame="0" Friction="12" MaxVelocity="6" Speed="0" Velocity="-4"/>
        </Animation>

        <Branch Key="(getKey_AttackCharge == true) || (getKey_NormalMove == true)" Condition="End" Execute="MoveAll"/>
        <Branch Key="getKey_AttackCharge == false" Condition="End" Execute="Idle"/>
    </AttackGuarded>

    <Guard MovementType="FrameEvent" DirectionType="MousePoint" DefenceDirectionType="MousePoint" FlipType="Keep" DefenceType="Guard" DefenceAngle="180.0">
        <Animation Path="Resources/Sprites/DummyPlayer/Guard/" StartFrame="0" EndFrame="1" FramePerSecond="1" XFlip="true">
            <FrameEvent Type="Movement" StartFrame="0" Friction="gv_IdleFriction" Speed="0"/>
        </Animation>

        <Branch Condition="End" Execute="Guard"/>
        <Branch Key="(getKey_Guard == false) && ((getKey_AttackCharge == true) || (getKey_NormalMove == true))" Execute="MoveAll"/>
        <Branch Key="(getKey_Guard == false) && (getKey_AttackCharge == false)" Execute="Idle"/>
    </Guard>

    <Kiiled DirectionType="Keep" FlipType="Direction">
        <Animation Path="Resources/Sprites/DummyPlayer/Hit/" StartFrame="0" EndFrame="1" FramePerSecond="99" XFlip="true">
            <FrameEvent Type="KillEntity" StartFrame="0"/>
        </Animation>

        <Branch Condition="End == true" Execute="Kiiled"/>
    </Kiiled>

</ActionGraph>